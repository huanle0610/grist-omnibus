issuer: '{{ getenv "APP_HOME_URL" }}/dex'

storage:
  type: sqlite3
  config:
    file: /persist/auth/dex.db

web:
  http: '0.0.0.0:{{ getenv "DEX_PORT" }}'

logger:
  level: "debug"
  format: "text"

frontend:
  issuer: "Grist"
  logoURL: '{{ getenv "APP_HOME_URL" }}/v/unknown/ui-icons/Logo/GristLogo.svg'

staticClients:
- id: '{{ getenv "GRIST_OIDC_IDP_CLIENT_ID" }}'
  redirectURIs:
  - '{{ getenv "APP_HOME_URL" }}/oauth2/callback'
  name: 'Grist'
  secret: '{{ getenv "GRIST_OIDC_IDP_CLIENT_SECRET" }}'


oauth2:
  skipApprovalScreen: true

connectors:

- type: ldap
  id: ldap
  name: MyAD
  config:
    host: "ds.domain.com"  # LDAP server and port (636 for LDAPS, 389 for ldap)
    insecureSkipVerify: true         # Skip SSL certificate verification (not recommended in production)
    insecureNoSSL: true
    bindDN: "CN=xxxx,CN=Users,DC=domain,DC=com" # DN of the user Dex will bind as
    bindPW: "xxxx"               # Password for the bind user
    userSearch:
      baseDN: "CN=Users,DC=domain,DC=com"  # Base DN to search for users
      filter: "(objectClass=user)"  # LDAP filter for users
      username: "sAMAccountName"    # LDAP attribute to use as the username
      idAttr: "DN"                  # LDAP attribute to use as the user ID
      emailAttr: "mail"             # LDAP attribute to use as the email
      nameAttr: "displayName"       # LDAP attribute to use as the full name
    groupSearch:
      baseDN: "CN=Users,DC=domain,DC=com"  # Base DN to search for groups
      filter: "(objectClass=group)"  # LDAP filter for groups
      userAttr: "DN"                 # LDAP attribute that links users to groups
      groupAttr: "member"            # LDAP attribute that contains users
      nameAttr: "cn"                 # LDAP attribute to use as the group name

 - type: google
   id: google
   name: Google
   config:
     issuer: https://accounts.google.com
     clientID: PUT_CLIENT_ID_HERE_PLEASE
     clientSecret: PUT_GOOGLE_CLIENT_SECRET_HERE_PLEASE
     redirectURI: '{{ getenv "APP_HOME_URL" }}/dex/callback'

 - type: microsoft
   id: microsoft
   name: Microsoft
   config:
     clientID: PUT_CLIENT_ID_HERE_PLEASE
     clientSecret: PUT_CLIENT_SECRET_HERE_PLEASE
     redirectURI: '{{ getenv "APP_HOME_URL" }}/dex/callback'
